<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style/index.css">
    <script src="/static/redirect.js"></script>
    <title>Home</title>
</head>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@v0.160.1/build/three.module.js",
            "three/gltfloader": "https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js",
            "three/trackballcontrols": "https://unpkg.com/three/examples/jsm/controls/TrackballControls.js"
        }
    }
</script>

<body>
    <nav class="nav-container">
        <div class="nav-alias">
            <div class="nav-headshot">
                <img src="/static/avatar_headshot.png" alt="Parcifel Avatar">
            </div>
            <h1>Parcifel</h1>
        </div>

        <div class="nav-links">
            <a class="link active" href="#hero">Home</a>
            <a class="link" href="/about.html">About</a>
            <a class="link" href="#hightlights">Portfolio</a>
            <a class="link" href="#contact">Contact Me</a>
        </div>  
    </nav>

    <div class="container hero-container" id="hero">
        <div class="hero-content">
            <div class="greeting">
                <h1>Hello there ...</h1>    
            </div>
            <div class="name">
                <h1 class="name-content"></h1>
            </div>
            <div class="summary">
                <p>
                    I am currently studying <mark>BSc Computer Science</mark> 
                    at Stellenbosch University with a focus on 
                    <mark>Machine Learning</mark> and <mark>Software Engineering</mark>.
                </p>
                <p>
                    I am a passionate software developer  and I 
                    love learning new things. I also like to design
                    new and clever algorithms to solve software related
                    problems.
                </p>
                <div class="hero-action">
                    Learn More
                </div>
            </div>
        </div>
        <div class="hero-headshot">
            <img src="/static/avatar_bodyshot.png" alt="Parcifel Avatar" class="hero-canvas">
          <!--
            <canvas class="hero-canvas"></canvas>
            <script type="module">
                var viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                var viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

                window.onresize = function(event) {
                    viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                    viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
                };

                import * as THREE from 'three';
                import { TrackballControls } from 'three/trackballcontrols';
                import { GLTFLoader } from 'three/gltfloader';
                
                let canvas = document.querySelector(".hero-canvas");
                let canvasWidth = canvas.clientWidth;
                let canvasHeight = canvas.clientHeight;

                let scene = new THREE.Scene();
                let camera = new THREE.PerspectiveCamera(75, canvasWidth / canvasHeight, 0.1, 1200);
                let renderer = new THREE.WebGLRenderer({
                    antialias: true, 
                    canvas: canvas
                });
                let loader = new GLTFLoader();

                camera.position.x = 0;
                camera.position.y = 1.5;
                camera.position.z = 1;

                renderer.setClearColor(0x000000, 0);
                renderer.setSize(canvasWidth, canvasHeight);

                loader.load(
                    '/static/3d-asset.glb',
                    (gltf) => {
                        let model = gltf.scene;
                        scene.add(model);
                    },
                    undefined,
                    (error) => {
                        console.error(error);
                    }
                );

                let frontalLight = new THREE.PointLight(0x404040, 100);
                frontalLight.position.set(0.5, 1.5, 1.5);
                scene.add(frontalLight);

                let backLight1 = new THREE.PointLight(0x404040, 50);
                let backLight2 = new THREE.PointLight(0x404040, 50);
                backLight1.position.set(-0.25, 2, -1.5);
                backLight2.position.set(-0.5, 1.3, 0.5);
                scene.add(backLight1);
                scene.add(backLight2);

                const rendering = () => {
                    requestAnimationFrame(rendering);
                    renderer.render(scene, camera);
                }

                rendering();


                console.log(canvas);
                console.log(canvas.getBoundingClientRect().top);
                console.log(canvas.getBoundingClientRect().left);

                let hero_container = document.querySelector(".hero-container");
                window.addEventListener("mousemove", (e) => {
                    let canvasTop = canvas.getBoundingClientRect().top;
                    let canvasLeft = canvas.getBoundingClientRect().left;
                    let canvasCenter = {
                        x: canvasLeft + (canvasWidth / 2),
                        y: canvasTop + (canvasHeight / 2)
                    }
                    let mousePos = {
                        x: e.clientX,
                        y: e.clientY
                    }

                    let heroContainerRect = hero_container.getBoundingClientRect();
                    if (mousePos.y < heroContainerRect.top || mousePos.y > heroContainerRect.bottom) {
                        return;
                    } else if (mousePos.x < heroContainerRect.left || mousePos.x > heroContainerRect.right) {
                        return;
                    }


                    let mousePosRel = {
                        x: mousePos.x - canvasCenter.x,
                        y: mousePos.y - canvasCenter.y
                    }

                    let rotationRation = Math.max(viewportHeight, viewportWidth) * 4.5;

                    let xRotation = (mousePosRel.y / rotationRation) + 0.2;
                    let yRotation = (mousePosRel.x / rotationRation) - 0.3;

                    scene.rotation.x = xRotation;
                    scene.rotation.y = yRotation;
                })

            </script>-->
        </div>
    </div>

    <div class="experience-container flow">
        <h1 class="experience-header">Experience</h1>

        <div class="experience-cards cards">
            <div class="cards-inner">
                <div class="cards-card card">
                    <h2 class="card-header">Fontend</h2>
                    <ul class="card-items flow" role="list">
                        <li>React Native</li>
                        <li>HTML/CSS</li>
                        <li>JavaScript</li>
                    </ul>
                </div>

                <div class="cards-card card">
                    <h2 class="card-header">Backend</h2>
                    <ul class="card-items flow" role="list">
                        <li>Django</li>
                        <li>Flask</li>
                        <li>Three</li>
                    </ul>
                </div>

                <div class="cards-card card">
                    <h2 class="card-header">Other</h2>
                    <ul class="card-items flow" role="list">
                        <li>C/C++</li>
                        <li>R</li>
                        <li>Pascal</li>
                        <li>Java</li>
                        <li>SQL</li>
                    </ul>
                </div>
            </div>

            <div class="overlay cards-inner"></div>
        </div>
    </div>

    <div class="container highlights-container" id="hightlights">
        Highlights Section
    </div>

    <div class="container action-container" id="contact" style="color: white;">
        Call to Action
    </div>

    <div class="container more-container">
      
    </div>

    <footer> 
        Footer
    </footer>
</body>
<script>
    async function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    let dev = true;

    if (dev) {
        //redirect("/underConstruction.html");
        const highlights_container = document.querySelector(".highlights-container");
        highlights_container.style.display = "none";
        const action_container = document.querySelector(".action-container");
        action_container.style.display = "none";

        const more_container = document.querySelector(".more-container");
        more_container.style.display = "block";
    }


    /*let btn = document.querySelector(".btn");
    btn.addEventListener("click", (e) => {
        transformNav();
    })*/

    /* NAVIGATION BAR*/
    let nav_bar = document.querySelector(".nav-container");

    /* Scroll Animation (Shrink/Grow) */
    window.addEventListener("scroll", (e) => {
        let vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0) / 100;

        if (window.scrollY > 60*vh) {
            if (! nav_bar.classList.contains("shrinked")) {
                shrinkNav();
            }
        } else {
            if (nav_bar.classList.contains("shrinked")) {
                expandNav();
            }
        }
    })

    async function shrinkNav() {
        nav_bar.classList.add("shrinked");

        let nav_links = document.querySelector(".nav-links");
        nav_links.style.width = "50%";

        await sleep(100);

        let nav_alias = document.querySelector(".nav-alias");
        nav_alias.style.width = "max-content";
        nav_alias.style.opacity = "1";
    }

    async function expandNav() {
        nav_bar.classList.remove("shrinked");

        let nav_alias = document.querySelector(".nav-alias");
        nav_alias.style.opacity = "0";

        await sleep(100);

        let nav_links = document.querySelector(".nav-links");
        nav_links.style.width = "100%";

        await sleep(200);
        nav_alias.style.width = "0";
    }

    /* Link activation */
    let links = document.querySelectorAll(".link");

    links.forEach( (link) => {
        link.addEventListener("click", () => {
            links.forEach( (l) => {
                if (link === l) {
                    l.classList.add("active");
                } else {
                    l.classList.remove("active");
                }
            })
        })
    })

    /* HERO SECTION */
    
    /* Type Writer effect */
    let name_content = document.querySelector(".name-content");
    let name_text = "I am Pierre du Toit"
    
    typeWriter(name_content, name_text, null);

    async function typeWriter(element, text, speed) {
        let i = 0;
        while (i < text.length) {
            let char = text.charAt(i);
            let inner_text = element.innerHTML + char;
            element.innerHTML = inner_text;
            i++;
    
            if (speed != null) {
                await sleep(speed);
            } else {
                await sleep(Math.floor(Math.random() * 100) + 200);
            
            }
        }
    }

    /* Experience Card Hover */
    /*let experience_cards = document.querySelectorAll(".experience-card");
    console.log(experience_cards);

    window.addEventListener("mousemove", (e) => {
        experience_cards.forEach((card) => {
            let blob = card.querySelector(".blob");
            let fakeblob = card.querySelector(".fakeblob");
            let rec = fakeblob.getBoundingClientRect();
            blob.style.opacity = "1";

            blob.animate (
                [
                    {
                        transform: `translate(${(e.clientX - rec.left) - (rec.width /2)}px, ${(e.clientY - rec.top) - (rec.height /2)}px)`
                    }
                ],
                {
                    diration: 300,
                    fill: "forwards"
                }
            );
        });
    })*/
/*
    const cards_container = document.querySelector(".cards");
    const cards_containre_inner = document.querySelector(".expereince-cards");
    const cards = Array.from(document.querySelectorAll(".card"));
    const overlay = document.querySelector(".overlay");

    const applyOverlayMask = (e) => {
        const overlayEl = e.currentTarget;
        const x = e.pageX - cards_container.offsetLeft;
        const y = e.pageY - cards_container.offsetTop;

        overlayEl.style = `--opacity: 1; --maskX: ${x}px; --maskY: ${y}px`;
    };

    const createOverlayCta = (overlay_card, ctaEl) => {
        
    };

    const observer = new ResizeObserver((entries) => {
        entries.forEach((entry) => {
            const card_intex = cards.indexOf(entry.target); 
            let width = entry.borderBoxSize[0].inlineSize;
            let height = entry.borderBoxSize[0].blockSize;

            if (card_index >= 0) {
                overlay.children[card_index].style.width = `${width}px`;
                overlay.children[card_index].style.height = `${height}px`;
            }
        });
    });

    const isitOverlayCard = (cardEl) => {
        const overlay_card = docuemnt.creaateElement("div");
        overlay_card.classList.add("card");
        overlay.append(overlay_card);
        observer.observe(cardEl);
    };

    cards.forEach(initOverlayCard);
    document.body.addEventListener("pointermove", applyOverlayMask);
*/

console.clear();
const cardsContainer = document.querySelector(".cards");
const cardsContainerInner = document.querySelector(".cards-inner");
const cards = Array.from(document.querySelectorAll(".card"));
const overlay = document.querySelector(".overlay");
const applyOverlayMask = (e) => {
  const overlayEl = e.currentTarget;
  const x = e.pageX - cardsContainer.offsetLeft;
  const y = e.pageY - cardsContainer.offsetTop;
  overlayEl.style = `--opacity: 1; --x: ${x}px; --y:${y}px;`;
};
const observer = new ResizeObserver((entries) => {
  entries.forEach((entry) => {
    const cardIndex = cards.indexOf(entry.target);
    let width = entry.borderBoxSize[0].inlineSize;
    let height = entry.borderBoxSize[0].blockSize;
    if (cardIndex >= 0) {
      overlay.children[cardIndex].style.width = `${width}px`;
      overlay.children[cardIndex].style.height = `${height}px`;
    }
  });
});
const initOverlayCard = (cardEl) => {
  const overlayCard = document.createElement("div");
  overlayCard.classList.add("card");
  overlay.append(overlayCard);
  observer.observe(cardEl);
};
cards.forEach(initOverlayCard);
document.body.addEventListener("pointermove", applyOverlayMask);

</script>

</html>
